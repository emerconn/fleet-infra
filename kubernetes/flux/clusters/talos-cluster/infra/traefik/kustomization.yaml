# yaml-language-server: $schema=https://json.schemastore.org/kustomization
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
- certificate.yaml
- ../../../../infra/classes/ingress/traefik.yaml
patches:
- patch: |-
    apiVersion: helm.toolkit.fluxcd.io/v2
    kind: HelmRelease
    metadata:
      name: traefik
      namespace: flux-system
    spec:
      values:
        deployment:
          kind: DaemonSet
        ingressClass:
          name: traefik
          enabled: true
          isDefaultClass: false
        ingressRoute:
          dashboard:
            enabled: true
            matchRule: Host(`traefik.homelab.emerconnelly.com`)
            entryPoints: ["web", "websecure"]
            middlewares:
            - name: https-redirect
            tls:
              secretName: cert-manager-tls
        service:
          spec:
            loadBalancerIP: 172.21.0.170
        extraObjects:
        - apiVersion: traefik.io/v1alpha1
          kind: Middleware
          metadata:
            name: https-redirect
          spec:
            redirectScheme:
              scheme: https
              permanent: true


