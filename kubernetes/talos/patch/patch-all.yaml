cluster:
  network:
    cni:
      name: none # manually install Cillium
  proxy:
    disabled: true # manually install Cillium
    image: registry.k8s.io/kube-proxy:v1.30.2
  apiServer:
    image: registry.k8s.io/kube-apiserver:v1.30.2
  controllerManager:
    image: registry.k8s.io/kube-controller-manager:v1.30.2
  scheduler:
    image: registry.k8s.io/kube-scheduler:v1.30.2
  extraManifests: # install metrics server
  - https://raw.githubusercontent.com/alex1989hu/kubelet-serving-cert-approver/main/deploy/standalone-install.yaml
  - https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml
  allowSchedulingOnControlPlanes: true

machine:
  install:
    image: factory.talos.dev/installer/446d7bb4b23caecb9134bcab115e52d55af742da8e04760817f6a31997dc32d9:v1.7.5 # iscsi-tools & btrfs, from Image Factory
    disk: /dev/sda
    wipe: true
    extraKernelArgs:
    - talos.platform=metal
  kubelet:
    image: ghcr.io/siderolabs/kubelet:v1.30.2
    extraArgs:
      rotate-server-certificates: true
  time:
    servers:
    - time.cloudflare.com
